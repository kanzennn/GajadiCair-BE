@startuml
skinparam classAttributeIconSize 0

' =======================
' ENUMS
' =======================
enum AttendanceStatus {
  PRESENT
  ABSENT
  LEAVE
  SICK
}

enum LeaveApplicationType {
  LEAVE
  SICK
}

enum PayrollDetailType {
  DEDUCTION
  ALLOWANCE
  BASE_SALARY
}

enum PayrollDeductionType {
  LATE
  ABSENT
  LEAVE
  SICK
}

enum SubscriptionChangeType {
  NEW
  RENEW
  EXTEND
  UPGRADE
  DOWNGRADE
  UPGRADE_RENEW
}

' =======================
' CORE DOMAIN
' =======================
class Company {
  +company_id: String <<PK>>
  +email: String
  +company_identifier: String
  +name: String
  +password: String?
  +avatar_uri: String?

  +level_plan: Int
  +plan_expiration: DateTime?

  +minimum_hours_per_day: Int?
  +attendance_open_time: Time?
  +attendance_close_time: Time?
  +work_start_time: Time?
  +attendance_tolerance_minutes: Int
  +payroll_day_of_month: Int?

  +attendance_location_enabled: Boolean
  +attendance_location: geography?
  +attendance_radius_meters: Int?

  +recognize_with_gesture: Boolean

  +last_login: DateTime?
  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

class Employee {
  +employee_id: String <<PK>>
  +company_id: String <<FK>>
  +bank_id: String? <<FK>>

  +name: String
  +username: String
  +email: String
  +password: String
  +is_active: Boolean

  +base_salary: Float
  +is_face_enrolled: Boolean

  +bank_account_number: String?
  +tax_identification_number: String?

  +avatar_uri: String?
  +last_login: DateTime?

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

class Bank {
  +bank_id: String <<PK>>
  +name: String
  +code: String
  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

' =======================
' ATTENDANCE
' =======================
class EmployeeAttendance {
  +employee_attendance_id: String <<PK>>
  +employee_id: String <<FK>>

  +attendance_date: Date <<unique(employee_id, attendance_date)>>
  +check_in_time: DateTime?
  +check_in_location: geography?
  +check_out_time: DateTime?
  +check_out_location: geography?
  +total_work_hours: Float?

  +status: AttendanceStatus
  +absent_reason: String?

  +late_minutes: Int?
  +is_late: Boolean

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

class AttendanceLog {
  +attendance_log_id: String <<PK>>
  +employee_id: String <<FK>>
  +log_type: Int  '0 check-in, 1 check-out
  +timestamp: DateTime

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

' =======================
' LEAVE / SICK
' =======================
class EmployeeLeaveApplication {
  +employee_leave_application_id: String <<PK>>
  +employee_id: String <<FK>>

  +start_date: Date
  +end_date: Date
  +reason: String
  +status: Int  '0 pending,1 approved,2 rejected
  +attachment_uri: String?
  +type: LeaveApplicationType

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

' =======================
' PAYROLL
' =======================
class PayrollLog {
  +payroll_log_id: String <<PK>>
  +employee_id: String <<FK>>
  +amount: Float
  +payroll_date: DateTime
  +pdf_uri: String?

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

class PayrollDetail {
  +payroll_detail_id: String <<PK>>
  +payroll_log_id: String <<FK>>

  +description: String
  +type: PayrollDetailType
  +amount: Float

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

class PayrollDeductionRule {
  +payroll_deduction_rule_id: String <<PK>>
  +company_id: String <<FK>>

  +name: String
  +type: PayrollDeductionType

  +percentage: Float?
  +fixed_amount: Float?

  +per_minute: Boolean
  +max_minutes: Int?
  +is_active: Boolean

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

class PayrollAllowanceRule {
  +payroll_allowance_rule_id: String <<PK>>
  +company_id: String <<FK>>

  +name: String
  +percentage: Float?
  +fixed_amount: Float?
  +is_active: Boolean

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

' =======================
' COMPANY SETTINGS / META
' =======================
class CompanyWorkingDay {
  +company_working_day_id: String <<PK>>
  +company_id: String <<FK>>

  +monday: Boolean
  +tuesday: Boolean
  +wednesday: Boolean
  +thursday: Boolean
  +friday: Boolean
  +saturday: Boolean
  +sunday: Boolean

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

class CompanyCustomHoliday {
  +company_custom_holiday_id: String <<PK>>
  +company_id: String <<FK>>

  +start_date: Date
  +end_date: Date
  +description: String

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

class CompanySocialite {
  +company_socialite_id: String <<PK>>
  +company_id: String <<FK>>

  +socialite_name: String
  +socialite_id: String
  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?

  'unique(socialite_name, socialite_id)
}

class CompanySubscriptionTransactionHistory {
  +company_subscription_id: String <<PK>>
  +company_id: String <<FK>>
  +midtrans_transaction_id: String?

  +gross_amount: Float
  +change_type: SubscriptionChangeType
  +from_level_plan: Int?
  +level_plan: Int
  +plan_duration_months: Int

  +period_start: DateTime?
  +period_end: DateTime?

  +midtrans_admin_fee: Float?
  +midtrans_status: String?
  +midtrans_payment_method: String?
  +midtrans_transaction_token: String
  +midtrans_redirect_url: String
  +midtrans_paid_at: DateTime?

  +created_at: DateTime
  +updated_at: DateTime
  +deleted_at: DateTime?
}

' =======================
' RELATIONSHIPS (Multiplicity)
' =======================
Company "1" o-- "0..*" Employee : employs
Bank "1" o-- "0..*" Employee : used_by
Employee "1" o-- "0..*" EmployeeAttendance : attendances
Employee "1" o-- "0..*" AttendanceLog : logs
Employee "1" o-- "0..*" EmployeeLeaveApplication : leave_requests
Employee "1" o-- "0..*" PayrollLog : payroll_logs
PayrollLog "1" o-- "0..*" PayrollDetail : details

Company "1" o-- "0..*" PayrollDeductionRule : deduction_rules
Company "1" o-- "0..*" PayrollAllowanceRule : allowance_rules
Company "1" o-- "0..*" CompanyCustomHoliday : holidays
Company "1" o-- "0..*" CompanySocialite : social_logins
Company "1" o-- "1" CompanyWorkingDay : working_days
Company "1" o-- "0..*" CompanySubscriptionTransactionHistory : subscription_histories

note right of EmployeeAttendance
Unique: (employee_id, attendance_date)
status PRESENT + is_late=true => treated as "LATE" on charts
end note

note bottom of Company
Soft delete: deleted_at used across tables
end note

@enduml
