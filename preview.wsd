@startuml
title Class Diagram - GajadiCair

skinparam classAttributeIconSize 0
hide empty members

' =========================
' COMPANY
' =========================
class Company {
  + company_id: string
  + name: string
  + email: string
  + company_identifier: string
  + avatar_uri: string
  + payroll_day_of_month: number
  + attendance_open_time: string
  + attendance_close_time: string
  + work_start_time: string
  + attendance_tolerance_minutes: number
  + minimum_hours_per_day: number
  + recognize_with_gesture: boolean
  --
  + login()
  + register()
  + loginByGoogle()
  + getProfile()
  + updateProfile()
  + createEmployee()
  + updateEmployee()
  + getEmployeeList()
  + getEmployeeDetail()
}

' =========================
' EMPLOYEE
' =========================
class Employee {
  + employee_id: string
  + company_id: string
  + name: string
  + email: string
  + username: string
  + is_active: boolean
  + base_salary: number
  + is_face_enrolled: boolean
  --
  + login()
  + getProfile()
  + updateProfile()
}

Company "1" o-- "*" Employee : employs

' =========================
' ATTENDANCE
' =========================
class Attendance {
  + attendance_date: Date
  + status: 'PRESENT' | 'ABSENT' | 'LEAVE' | 'SICK'
  + check_in_time: Date
  + check_out_time: Date
  + is_late: boolean
  --
  + canCheckIn()
  + canCheckOut()
  + checkInFace()
  + checkOutFace()
}


Employee "1" o-- "*" Attendance : records
Attendance ..> Company : uses attendance rules

' =========================
' PAYROLL (Snapshot)
' =========================
class Payroll {
  + payroll_id: string
  + payroll_date: Date
  + base_salary: number
  + total_allowance: number
  + total_deduction: number
  + net_salary: number
  --
  + getDetails()
  + calculatePayroll()
}

class PayrollDetail {
  + payroll_detail_id: string
  + description: string
  + type: 'BASE_SALARY' | 'ALLOWANCE' | 'DEDUCTION'
  + amount: number
  + source_ref: string
  --
}

Employee "1" o-- "*" Payroll : receives
Payroll "1" o-- "*" PayrollDetail : consists_of

' =========================
' PAYROLL RULES (Company Master)
' =========================
class PayrollAllowanceRule {
  + payroll_allowance_rule_id: string
  + company_id: string
  + name: string
  + amount: number
  + is_active: boolean
}

class PayrollDeductionRule {
  + payroll_deduction_rule_id: string
  + company_id: string
  + name: string
  + amount: number
  + is_active: boolean
}

Company "1" o-- "*" PayrollAllowanceRule : defines
Company "1" o-- "*" PayrollDeductionRule : defines

Payroll ..> PayrollAllowanceRule : reads rules
Payroll ..> PayrollDeductionRule : reads rules

' =========================
' SUBSCRIPTION
' =========================
class Subscription {
  + subscription_id: string
  + level_plan: number
  + period_start: Date
  + period_end: Date
  --
  + getCurrentSubscription()
  + getSubscriptionHistory()
  + generateSubscriptionSnap()
}

Company "1" o-- "*" Subscription : subscribes

' =========================
' FACE RECOGNITION (External Service)
' =========================
class FaceRecognition {
  --
  + checkFace()
  + enrollFace()
  + verifyFace()
  + deleteFaceData()
  + getGestureList()
}

FaceRecognition ..> Employee : verifies

' =========================
' JOBS
' =========================
class AttendanceJob {
  --
  + handleAutoAbsent()
}

class PayrollJob {
  --
  + runMonthlyPayroll()
}

AttendanceJob ..> Employee
AttendanceJob ..> Attendance
AttendanceJob ..> Company

PayrollJob ..> Company
PayrollJob ..> Employee
PayrollJob ..> Payroll
PayrollJob ..> PayrollDetail

' =========================
' WORKING DAYS & HOLIDAYS
' =========================
class WorkingDay {
  + monday: boolean
  + tuesday: boolean
  + wednesday: boolean
  + thursday: boolean
  + friday: boolean
  + saturday: boolean
  + sunday: boolean
  --
  + getWorkingDays()
  + updateWorkingDays()
  + isWorkingDay()
}

class CustomHoliday {
  + company_id: string
  + start_date: Date
  + end_date: Date
  + description: string
  --
  + getAllHolidays()
  + isHoliday()
  + addHoliday()
  + removeHoliday()
}

Company "1" o-- "1" WorkingDay : has
Company "1" o-- "*" CustomHoliday : defines

@enduml
